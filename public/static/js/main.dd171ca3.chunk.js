(this.webpackJsonproadmapex=this.webpackJsonproadmapex||[]).push([[0],Array(23).concat([function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,function(e,t,n){},,function(e,t,n){e.exports=n.p+"static/media/Logo6.1eb79660.jpg"},,function(e,t,n){e.exports=n.p+"static/media/Plan2.2b80226e.png"},,function(e,t,n){e.exports=n(82)},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},,function(e,t,n){},,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(22),s=n.n(i),r=(n(41),n(14)),c=n(9),l=(n(42),n(3)),u=(n(43),n(1)),d=n.n(u),h=n(4),p=n(31),m=function(e,t,n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3);var o="expires="+a.toUTCString();document.cookie=e+"="+t+";"+o+";path=/"},f=function(e){var t,n=document.cookie.split(";").map((function(e){return e.trim()})),a=Object(p.a)(n);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(o.startsWith(e+"="))return o.substring(e.length+1)}}catch(i){a.e(i)}finally{a.f()}return null};function v(e,t,n,a){return g.apply(this,arguments)}function g(){return(g=Object(h.a)(d.a.mark((function e(t,n,a,o){var i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="/api/v1"+n,e.abrupt("return",fetch(i,{method:t,headers:{Authorization:"Bearer "+f("mpx_user"),"Content-Type":o||"application/json"},body:JSON.stringify(a)}).then((function(e){return E(e)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return C.apply(this,arguments)}function C(){return(C=Object(h.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.ok){e.next=2;break}return e.abrupt("return",t);case 2:return e.next=4,t.json();case 4:return n=e.sent,e.next=7,Promise.reject(n);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var b=n(32),y=n.n(b);n(45);function S(e){var t=e.label,n=e.to,a=Object(c.useRouteMatch)(n),i=(null===a||void 0===a?void 0:a.isExact)?"active-link":"";return o.a.createElement("p",{className:"menu-item ".concat(i)},o.a.createElement(r.b,{to:n},t))}n(51);function O(){return o.a.createElement("div",{className:"header-search"},o.a.createElement("div",{className:"header-search-logo"},"\ud83d\udd0e\ufe0e"),o.a.createElement("input",{className:"header-search-input",type:"text",placeholder:"Search"}))}function k(){var e=Object(a.useRef)(),t=Object(a.useState)("User"),n=Object(l.a)(t,2),i=n[0],s=n[1];return Object(a.useEffect)((function(){v("GET","/user/you/avatar").then((function(e){return e.json()})).then((function(t){return e.current.src=t})).catch((function(e){return console.error(e)}))}),[]),Object(a.useEffect)((function(){v("GET","/user/you").then((function(e){return e.json()})).then((function(e){return s(e.username||"User")})).catch((function(e){return console.log(e)}))}),[]),o.a.createElement("header",{className:"header"},o.a.createElement("nav",{className:"header__left"},o.a.createElement("div",{className:"header__logo"},o.a.createElement("img",{src:y.a,height:"60px",alt:"Logo"}),o.a.createElement("div",{className:"header__logo-name"},"Map",o.a.createElement("span",{className:"header__logo-name-tail"},"ex"))),o.a.createElement("ul",{className:"header__left-nav"},o.a.createElement("li",null,o.a.createElement(S,{to:"/",label:"Home"})),o.a.createElement("li",null,o.a.createElement(S,{to:"/library",label:"Library"})))),o.a.createElement(O,null),o.a.createElement("div",{className:"header__right"},o.a.createElement("div",{className:"header__user-nav"},o.a.createElement("div",{className:"header__user-name"},o.a.createElement(r.b,{to:"/user/you"},i)),o.a.createElement("div",{className:"header__user-avatar"},o.a.createElement("img",{className:"header__user-avatar-img",ref:e})))))}n(52),n(53);function N(e){var t=Object(a.useRef)();Object(a.useEffect)((function(){v("GET","/user/you/avatar").then((function(e){return e.json()})).then((function(e){return t.current.src=e})).catch((function(e){return console.error(e)}))}),[]);var n=function(e){v("POST","/user/you/avatar",e,"application/octet-stream").then((function(e){return e.json()})).then((function(n){return t.current.src=e})).catch((function(e){return console.error(e)}))};return o.a.createElement("div",{className:"profile-header__avatar"},o.a.createElement("img",{className:"profile-header__avatar-img",ref:t}),o.a.createElement("input",{className:"avatar-upload",type:"file",accept:"image/*",onChange:function(e){e.preventDefault();var t=new FileReader;t.readAsDataURL(e.target.files[0]),t.onload=function(e){n(e.target.result)}}}))}function j(){Object(a.useRef)();var e=Object(a.useState)(""),t=Object(l.a)(e,2),n=t[0],i=t[1],s=Object(a.useState)(""),r=Object(l.a)(s,2),c=r[0],u=r[1];Object(a.useEffect)((function(){v("GET","/user/you").then((function(e){return e.json()})).then((function(e){return function(e){i(e.username||"User"),u(e.email)}(e)})).catch((function(e){return console.log(e)}))}),[]);return o.a.createElement("div",{className:"profile-header"},o.a.createElement("div",{className:"profile-header__background"},o.a.createElement("div",{className:"profile-header__content"},o.a.createElement(N,null),o.a.createElement("div",{className:"profile-header__info"},o.a.createElement("div",{className:"profile-header__info-content"},o.a.createElement("input",{className:"profile-username",value:n,onChange:function(e){return i(e.target.value)},onBlur:function(){v("PUT","/user/you",{username:n}).catch((function(e){return console.log(e)}))}}),o.a.createElement("h4",{className:"profile-header__info-item"},c))))))}n(54),n(55),n(56);n(57);n(58);n(59);n(60);n(61);n(62);function x(e){var t=e.children,n=document.getElementById("modal"),o=document.createElement("div");return o.classList.add("modal-dialog"),Object(a.useEffect)((function(){return n.appendChild(o),function(){n.removeChild(o)}})),Object(i.createPortal)(t,o)}function M(){var e=Object(c.useHistory)(),t=Object(a.useState)(!1),n=Object(l.a)(t,2),i=n[0],s=n[1],r=function(t){v("POST","/maps",t).then((function(e){return e.json()})).then((function(t){return e.push("map/".concat(t.id,"/edit"))})).catch((function(e){return console.error(e)}))};return o.a.createElement("div",{className:"add-board",onClick:function(){return s(!0)}},o.a.createElement("div",{className:"add-board__shadow"},o.a.createElement("div",{className:"add-board__plus"},"+"),o.a.createElement("div",{className:"add-board__title"},"New")),i?o.a.createElement(x,null,o.a.createElement(x.EditCanvas,{okButtonName:"Create",onCancel:function(){return s(!1)},onOk:function(e){var t=e.name,n=e.description;r({name:t||"Untitled",description:n||"not described yet..."})}})):null)}x.Content=function(e){var t=e.children;return o.a.createElement("div",{className:"modal-content",onClick:function(e){return e.stopPropagation()}},t)},x.Body=function(e){var t=e.children;return o.a.createElement("div",{className:"modal-body"},t)},x.Footer=function(e){var t=e.children;return o.a.createElement("div",{className:"modal-footer"},t)},x.PrimaryButton=function(e){var t=e.children,n=e.action;return o.a.createElement("button",{className:"modal-button button-primary",onClick:function(e){e.stopPropagation(),n&&n()}},t)},x.EditCanvas=function(e){var t=e.title,n=void 0===t?"":t,i=e.description,s=void 0===i?"":i,r=e.okButtonName,c=void 0===r?"Save":r,l=e.onCancel,u=e.onOk,d=Object(a.useRef)(),h=Object(a.useRef)();return o.a.createElement(x.Content,null,o.a.createElement(x.Body,null,o.a.createElement("div",{className:"modal-body-item"},o.a.createElement("input",{ref:d,defaultValue:n,placeholder:"Title",type:"text"})),o.a.createElement("div",{className:"modal-body-item"},o.a.createElement("textarea",{ref:h,defaultValue:s,placeholder:"Description"}))),o.a.createElement(x.Footer,null,o.a.createElement(x.PrimaryButton,{action:l},"Cancel"),o.a.createElement(x.PrimaryButton,{action:function(){var e=d.current.value,t=h.current.value;u&&u({name:e,description:t})}},c)))},x.EditStage=function(e){var t=e.id,n=e.okButtonName,i=void 0===n?"Save":n,s=e.onCancel,r=Object(a.useState)(null),c=Object(l.a)(r,2),u=c[0],d=c[1],h=Object(a.useState)(""),p=Object(l.a)(h,2),m=p[0],f=p[1],g=Object(a.useState)(""),E=Object(l.a)(g,2),C=E[0],b=E[1];Object(a.useEffect)((function(){v("GET","/stages/".concat(t)).then((function(e){return e.json()})).then((function(e){return y(e)})).catch((function(e){return console.error(e)}))}),[]);var y=function(e){d(e),f(e.data.title),b(e.data.description)};return o.a.createElement(x.Content,null,o.a.createElement(x.Body,null,o.a.createElement("input",{disabled:!0,className:"stage-title",value:m,onChange:function(e){return f(e.target.value)}}),o.a.createElement("textarea",{className:"stage-description",placeholder:"description...",rows:"20",cols:"50",value:C,onChange:function(e){return b(e.target.value)}})),o.a.createElement(x.Footer,null,o.a.createElement(x.PrimaryButton,{action:s},"Cancel"),o.a.createElement(x.PrimaryButton,{action:function(){u.data.description=C,v("PUT","/stages/".concat(t),u).then((function(e){return e.json()})).then((function(e){return console.log(e)})).catch((function(e){return console.error(e)})).finally((function(){return s()}))}},i)))},x.PassStage=function(e){var t=e.id,n=e.okButtonName,i=void 0===n?"Save":n,s=Object(a.useState)(null),r=Object(l.a)(s,2),c=(r[0],r[1]),u=Object(a.useState)(""),d=Object(l.a)(u,2),h=d[0],p=d[1],m=Object(a.useState)(""),f=Object(l.a)(m,2),g=f[0],E=f[1],C=Object(a.useState)("None"),b=Object(l.a)(C,2),y=b[0],S=b[1];Object(a.useEffect)((function(){v("GET","/stages/".concat(t)).then((function(e){return e.json()})).then((function(e){return O(e)})).catch((function(e){return console.error(e)}))}),[]);var O=function(e){c(e),p(e.data.title),E(e.data.description),S(e.data.status)};return o.a.createElement(x.Content,null,o.a.createElement(x.Body,null,o.a.createElement("input",{disabled:!0,className:"stage-title",value:h,onChange:function(e){return p(e.target.value)}}),o.a.createElement("textarea",{disabled:!0,className:"stage-description",placeholder:"description...",rows:"20",cols:"50",value:g,onChange:function(e){return E(e.target.value)}}),o.a.createElement("div",{className:"pass-stage-status"},o.a.createElement("label",null,"Status:"),o.a.createElement("select",{onChange:function(n){var a=n.target.value;v("PUT","/stages/".concat(t,"/status"),{status:a}).then((function(e){return e.json()})).then((function(n){S(a),e.onChangeStatus(t,a)})).catch((function(e){return console.error(e)}))},value:y},o.a.createElement("option",{value:"None"},"None"),o.a.createElement("option",{value:"InProgress"},"\u23e9In progress"),o.a.createElement("option",{value:"Done"},"\u2714\ufe0fDone"),o.a.createElement("option",{value:"Canceled"},"\u274cCenceled")))),o.a.createElement(x.Footer,null,o.a.createElement(x.PrimaryButton,{action:e.onOk},i)))};n(63),n(64);function w(e){var t=e.isOpen,n=e.canvasId,i=e.canvasTitle,s=e.canvasDescription,r=e.hideBoardPin,c=e.updateBoardPin,u=Object(a.useState)(!1),d=Object(l.a)(u,2),h=d[0],p=d[1],m=function(){return p(!1)};return o.a.createElement("ul",{className:"board-pin__menu",style:{display:t?"block":"none"}},o.a.createElement("li",{className:"board-pin__menu-item",onClick:function(){return p(!0)}},"Edit"),o.a.createElement("li",{className:"board-pin__menu-item",onClick:function(){v("DELETE","/maps/".concat(n)).then((function(e){return r()})).catch((function(e){return console.log(e)}))}},"Delete"),h?o.a.createElement(x,null,o.a.createElement(x.EditCanvas,{title:i,description:s,onCancel:m,onOk:function(e){var t=e.name,a=e.description,o={name:t||"Untitled",description:a||"not described yet..."};v("PUT","/maps/".concat(n),o).then((function(e){return c(t,a)})).then((function(){return m()})).catch((function(e){return console.log(e)}))}})):null)}function D(e){var t=e.id,n=e.title,i=e.description,s=Object(c.useHistory)(),r=Object(a.useState)(!1),u=Object(l.a)(r,2),d=u[0],h=u[1],p=Object(a.useState)(!1),m=Object(l.a)(p,2),f=m[0],g=m[1],E=Object(a.useState)(n),C=Object(l.a)(E,2),b=C[0],y=C[1],S=Object(a.useState)(i),O=Object(l.a)(S,2),k=O[0],N=O[1],j=Object(a.useRef)(null);return Object(a.useEffect)((function(){v("GET","/maps/".concat(e.id,"/img")).then((function(e){return e.json()})).then((function(e){j.current.src=e})).catch((function(e){return console.error(e)}))}),[]),o.a.createElement("div",{className:"board-pin",style:{display:f?"none":"block"},onClick:function(){s.push("/map/".concat(t,"/passing"))}},o.a.createElement("div",{className:"board-pin__preview",onMouseLeave:function(){return h(!1)}},o.a.createElement("img",{className:"board-pin__image",ref:j}),o.a.createElement("div",{className:"board-pin__description"},k),o.a.createElement("div",{className:"board-pin__menu-btn",onClick:function(e){h(!d),e.stopPropagation()}},"...",o.a.createElement(w,{isOpen:d,canvasId:t,canvasTitle:b,canvasDescription:k,hideBoardPin:function(){return g(!0)},updateBoardPin:function(e,t){y(e),N(t)}})),o.a.createElement("div",{className:"board-pin__overlay"})),o.a.createElement("div",{className:"board-pin__info"},o.a.createElement("div",{className:"board-pin__info-title",title:b},b)))}n(65),n(66);function L(){return o.a.createElement("div",{className:"loader"},"Loading...")}function T(){var e=Object(a.useState)(!0),t=Object(l.a)(e,2),n=t[0],i=t[1],s=Object(a.useState)([]),r=Object(l.a)(s,2),c=r[0],u=r[1];return Object(a.useEffect)((function(){var e=!0;return v("GET","/maps").then((function(e){return e.json()})).then((function(t){e&&u(t)})).catch((function(e){return console.log(e)})).finally((function(){return i(!1)})),function(){e=!1}}),[]),n?o.a.createElement(L,null):o.a.createElement("div",{className:"dashboard-container"},o.a.createElement("div",{className:"maps-switcher"},o.a.createElement("div",{className:"maps-switcher-cat cat-choosen"},"Created"),o.a.createElement("div",{className:"maps-switcher-cat"},"Saved")),o.a.createElement("div",{className:"boards-holder"},o.a.createElement(M,null),c.map((function(e){return o.a.createElement(D,{key:e.id,id:e.id,title:e.name,description:e.description})}))))}var P=n(5),I=n(6),_=n(2),B=n(8),z=n(7),R=(n(23),n(18));n(24);function U(e){var t=Object(R.useHistory)();return o.a.createElement("div",{className:"canvas-header-container"},o.a.createElement("header",{className:"canvas-header"},o.a.createElement("div",{className:"header-about"},o.a.createElement("div",{className:"header-title"},e.title||"Title"),o.a.createElement("div",{className:"header-description"},e.description||"Some description")),o.a.createElement("div",{className:"header-actions"},o.a.createElement("input",{className:"header-nav-button",type:"button",value:"\u2190 Library",onClick:function(){t.push("/library")}}),o.a.createElement("input",{className:"header-nav-button",type:"button",value:"\u270e Edit",onClick:function(){t.push("/map/".concat(e.mapId,"/edit"))}}))))}var F={BottomRight:function(e,t,n){var a=.5*n;return"M"+a+" "+a+" L"+(t-a)+" "+(e-a)},BottomLeft:function(e,t,n){var a=.5*n;return"M"+(t-a)+" "+a+" L"+a+" "+(e-a)},TopRight:function(e,t,n){var a=.5*n;return"M"+(t-a)+" "+a+" L"+a+" "+(e-a)},TopLeft:function(e,t,n){var a=.5*n;return"M"+(t-a)+" "+(e-a)+" L"+a+" "+a}},A={curve:{horizontal:{BottomRight:function(e,t,n){var a=.5*n;return"M0 "+a+"Q "+t/3.5+" 0 "+t/2+" "+e/2+" T "+t+" "+(e-a)},BottomLeft:function(e,t,n){var a=.5*n;return"M"+(t-a)+" "+a+"Q "+t/1.5+" 0 "+t/2+" "+e/2+" T "+a+" "+(e-a)},TopRight:function(e,t,n){var a=.5*n;return"M"+a+" "+(e-a)+" Q "+t/3.5+" "+e+" "+t/2+" "+e/2+" T "+(t-a)+" "+a},TopLeft:function(e,t,n){var a=.5*n;return"M"+a+" "+a+"Q "+t/3.5+" 0 "+t/2+" "+e/2+" T "+(t-a)+" "+(e-a)}},vertical:{BottomRight:function(e,t,n){var a=.5*n;return"M"+a+" "+a+"Q 0 "+e/3.5+" "+t/2+" "+e/2+" T "+(t-a)+" "+(e-a)},BottomLeft:function(e,t,n){var a=.5*n;return"M"+(t-a)+" "+a+"Q "+(t-a)+" "+e/3.5+" "+t/2+" "+e/2+" T "+a+" "+(e-a)},TopRight:function(e,t,n){var a=.5*n;return"M"+a+" "+(e-a)+" Q 0 "+e/1.5+" "+t/2+" "+e/2+" T "+(t-a)+" "+a},TopLeft:function(e,t,n){var a=.5*n;return"M"+a+" "+a+"Q 0 "+e/3.5+" "+t/2+" "+e/2+" T "+(t-a)+" "+(e-a)}}},rectangular:{horizontal:{BottomRight:function(e,t,n){var a=.5*n;return"M"+a+" "+a+" L"+t/2+" "+a+" L"+t/2+" "+(e-a)+" L"+(t-a)+" "+(e-a)},BottomLeft:function(e,t,n){var a=.5*n;return"M"+(t-a)+" "+a+" L"+t/2+" "+a+" L"+t/2+" "+(e-a)+" L"+a+" "+(e-a)},TopRight:function(e,t,n){var a=.5*n;return"M"+a+" "+(e-a)+" L"+t/2+" "+(e-a)+" L"+t/2+" "+a+" L"+(t-a)+" "+a},TopLeft:function(e,t,n){var a=.5*n;return"M"+(t-a)+" "+(e-a)+" L"+t/2+" "+(e-a)+" L"+t/2+" "+a+" L"+a+" "+a}},vertical:{BottomRight:function(e,t,n){var a=.5*n;return"M"+a+" "+a+" L"+a+" "+e/2+" L"+(t-a)+" "+e/2+" L"+(t-a)+" "+(e-a)},BottomLeft:function(e,t,n){var a=.5*n;return"M"+(t-a)+" "+a+" L"+(t-a)+" "+e/2+" L"+a+" "+e/2+" L"+a+" "+(e-a)},TopRight:function(e,t,n){var a=.5*n;return"M"+a+" "+(e-a)+" L"+a+" "+e/2+" L"+(t-a)+" "+e/2+" L"+(t-a)+" "+a},TopLeft:function(e,t,n){var a=.5*n;return"M"+(t-a)+" "+(e-a)+" L"+(t-a)+" "+e/2+" L"+a+" "+e/2+" L"+a+" "+a}}},straight:{horizontal:F,vertical:F}},X={BottomRight:function(e,t,n){var a=n-1;return{x:e.x-a/2,y:e.y-a/2,width:t.x-e.x+n,height:t.y-e.y+n}},BottomLeft:function(e,t,n){var a=n-1;return{x:t.x-a/2,y:e.y-a/2,width:e.x-t.x+n,height:t.y-e.y+n}},TopRight:function(e,t,n){var a=n-1;return{x:e.x-a/2,y:t.y-a/2,width:t.x-e.x+n,height:e.y-t.y+n}},TopLeft:function(e,t,n){var a=n-1;return{x:t.x-a/2,y:t.y-a/2,width:e.x-t.x+n,height:e.y-t.y+n}}},Y=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).handleMouseMove=a.handleMouseMove.bind(Object(_.a)(a)),a.handleMouseEnter=a.handleMouseEnter.bind(Object(_.a)(a)),a.handleMouseLeave=a.handleMouseLeave.bind(Object(_.a)(a)),a}return Object(I.a)(n,[{key:"handleMouseMove",value:function(e){this.raiseEdgeLayer(e.pageX-window.scrollX,e.pageY-window.scrollY)}},{key:"raiseEdgeLayer",value:function(e,t){var n=document.elementFromPoint(e,t);n.classList.contains("edge")?n.closest(".edge-rect").style.zIndex=Number("100")+10:n.classList.contains("edge-rect")&&(n.style.zIndex="100",n.style.visibility="hidden",this.raiseEdgeLayer(e,t),n.style.visibility="visible")}},{key:"handleMouseEnter",value:function(e){e.target.style.cursor="pointer"}},{key:"handleMouseLeave",value:function(e){}},{key:"render",value:function(){if(!this.props.isShown)return null;var e=this.props,t=e.from,n=e.to,a=e.width,i=void 0===a?1:a,s=e.type,r=void 0===s?"straight":s,c=e.orientation,l=void 0===c?"horizontal":c,u=e.isDashed,d=void 0!==u&&u,h=this.getDirectionName(t,n),p=X[h](t,n,i),m={position:"absolute",top:p.y,left:p.x,height:p.height,width:p.width,strokeDasharray:d?3*i+" "+2*i:"",zIndex:"100"},f=(0,A[r][l][h])(p.height,p.width,i);return o.a.createElement("svg",{className:"edge-rect",xmlns:"http://www.w3.org/2000/svg",style:m,onMouseMove:this.handleMouseMove,"data-allow-context-menu":"true"},o.a.createElement("path",{"data-id":this.props.id,"data-allow-context-menu":"true",className:"edge",d:f,stroke:"black",strokeWidth:i,fill:"transparent",strokeLinecap:"round",strokeLinejoin:"round",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave}))}},{key:"getDirectionName",value:function(e,t){return this.getVerticalName(e,t)+this.getHorizontalName(e,t)}},{key:"getVerticalName",value:function(e,t){return this.isTop(e,t)?"Top":"Bottom"}},{key:"getHorizontalName",value:function(e,t){return this.isRight(e,t)?"Right":"Left"}},{key:"isRight",value:function(e,t){return e.x<t.x}},{key:"isTop",value:function(e,t){return e.y>t.y}}]),n}(o.a.Component),W=(n(67),n(30),function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).inputElement=o.a.createRef(),a}return Object(I.a)(n,[{key:"componentDidMount",value:function(){this.props.initSize(this.inputElement.current)}},{key:"render",value:function(){var e={backgroundColor:this.props.backgroundColor,cursor:"pointer"};return o.a.createElement("textarea",{"data-id":this.props.stageId,disabled:!0,ref:this.inputElement,className:"node-title",style:e,rows:this.props.rows,defaultValue:this.props.text,draggable:!0,onDragStart:function(e){return e.preventDefault()},onClick:this.props.onClick})}}]),n}(o.a.Component)),V=(n(68),{InProgress:o.a.createElement("div",{className:"current-status status-passing"},"\u21d2"),Done:o.a.createElement("div",{className:"current-status status-done"},"\u2714"),Canceled:o.a.createElement("div",{className:"current-status status-canceled"},"\u2716")});function H(e){return o.a.createElement("div",{className:"stage-status"},V[e.status]||null)}var G=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).state={rows:1,width:"5px",isConnectionPointsShown:!1,color:a.props.color,isPassingMenuOpen:!1,isHover:!1},a.handleClick=a.handleClick.bind(Object(_.a)(a)),a.setSize=a.setSize.bind(Object(_.a)(a)),a.handleMouseEnter=a.handleMouseEnter.bind(Object(_.a)(a)),a.handleMouseLeave=a.handleMouseLeave.bind(Object(_.a)(a)),a}return Object(I.a)(n,[{key:"handleClick",value:function(e){this.props.openEditStage(e)}},{key:"setSize",value:function(e){var t=e.value.split("\n"),n=t.sort((function(e,t){return t.length-e.length}))[0],a=this.getFontDescriptor(e),o=this.getTextWidth(n,a);this.setState({width:5+o+"px",rows:t.length}),this.props.setLastTouchedNode(e.closest(".node"))}},{key:"getTextWidth",value:function(e,t){var n=document.createElement("canvas").getContext("2d");return n.font=t,n.measureText(e).width}},{key:"getFontDescriptor",value:function(e){return getComputedStyle(e).getPropertyValue("font-weight")+" "+getComputedStyle(e).getPropertyValue("font-size")+" "+getComputedStyle(e).getPropertyValue("font-family")}},{key:"handleMouseEnter",value:function(e){this.setState({isPassingMenuOpen:!0}),this.setState({isHover:!0})}},{key:"handleMouseLeave",value:function(e){this.setState({isPassingMenuOpen:!1}),this.setState({isHover:!1})}},{key:"render",value:function(){var e={left:this.state.isHover?this.props.position.x-1:this.props.position.x,top:this.state.isHover?this.props.position.y-1:this.props.position.y,backgroundColor:this.props.color,width:this.state.width,zIndex:this.props.isContextMenuOpen?"4000":"1000"};return o.a.createElement("div",{"data-id":this.props.id,className:"stage-passing",style:e,"data-allow-context-menu":!0,onClick:this.handleClick,onChange:this.handleChangeColor,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},o.a.createElement(W,{stageId:this.props.id,text:this.props.title,rows:this.state.rows,initSize:this.setSize,backgroundColor:this.props.color}),o.a.createElement(H,{status:this.props.status}))}}]),n}(o.a.Component),q=(n(69),function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(){return Object(P.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"render",value:function(){if(!this.props.isOpen)return null;var e={left:this.props.positionX,top:this.props.positionY};return o.a.createElement("div",{className:"canvas-context-menu",style:e},o.a.createElement("p",{onClick:this.props.handleClickCreateNode},"+ add stage"))}}]),n}(o.a.Component));function Q(e){return e.sort((function(e,t){return t.position.y-e.position.y}))[0]}function J(e){return e.sort((function(e,t){return t.position.x-e.position.x}))[0]}function K(e,t){return{height:function(e,t){var n=Q(t),a=e.querySelector("div[data-id='".concat(n.id,"']")).offsetHeight,o=n.position.y+a;return o<=300?300:o+(100-o%100)}(e,t),width:function(e,t){var n=J(t),a=e.querySelector("div[data-id='".concat(n.id,"']")).offsetWidth,o=n.position.x+a;return o<=900?900:o+(100-o%100)}(e,t)}}function Z(e,t){return{height:function(e,t){var n=parseInt(getComputedStyle(e).getPropertyValue("height"));if(n<=300)return 300;var a=Q(t),o=e.querySelector("div[data-id='".concat(a.id,"']")).offsetHeight,i=n-(a.position.y+o),s=i-i%100;return a.position.y+o<n-100?n-s:n}(e,t),width:function(e,t){var n=parseInt(getComputedStyle(e).getPropertyValue("width"));if(n<=900)return 900;var a=J(t),o=e.querySelector("div[data-id='".concat(a.id,"']")).offsetWidth,i=n-(a.position.x+o),s=i-i%100;return a.position.x+o<n-100?n-s:n}(e,t)}}function $(e,t,n,a,o){return{height:function(e,t,n){var a=parseInt(getComputedStyle(e).getPropertyValue("height"));return n-e.offsetTop+t.offsetHeight>a?a+100:a}(e,n,o),width:function(e,t,n,a){var o=parseInt(getComputedStyle(e).getPropertyValue("width"));return a-e.offsetLeft+t.scrollLeft+t.scrollLeft+n.offsetWidth>o?o+100:o}(e,t,n,a)}}n(70);function ee(e){if(!e.isOpen)return null;var t={left:e.positionX,top:e.positionY};return o.a.createElement("div",{className:"edge-context-menu",style:t},o.a.createElement("div",{className:"menu-point"},"Type"),o.a.createElement("div",{className:"menu-point"},"Size"),o.a.createElement("div",{className:"menu-point"},"Color"),o.a.createElement("div",{className:"menu-point delete-edge",onClick:function(){e.onDelete(e.edgeId)}},"Delete"))}var te=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).state={isContextMenuOpen:!1,isEdgeMenuOpen:!1,editStageId:null,edgeMenuPosition:{x:0,y:0},isEdgeCreating:!1,isSizeInit:!1,demoEdgeFrom:{x:0,y:0},demoEdgeTo:{x:0,y:0}},a.canvasWrapper=o.a.createRef(),a.canvasElement=o.a.createRef(),a.canvasScroll=o.a.createRef(),a.handleContextMenu=a.handleContextMenu.bind(Object(_.a)(a)),a.handleClick=a.handleClick.bind(Object(_.a)(a)),a.handleClickCreateNode=a.handleClickCreateNode.bind(Object(_.a)(a)),a.handleDeleteNode=a.handleDeleteNode.bind(Object(_.a)(a)),a.handleDragStart=a.handleDragStart.bind(Object(_.a)(a)),a.handleDrag=a.handleDrag.bind(Object(_.a)(a)),a.handleDragEnd=a.handleDragEnd.bind(Object(_.a)(a)),a.handleMouseDown=a.handleMouseDown.bind(Object(_.a)(a)),a.handleMouseUp=a.handleMouseUp.bind(Object(_.a)(a)),a.handleMouseMove=a.handleMouseMove.bind(Object(_.a)(a)),a.setLastTouchedNode=a.setLastTouchedNode.bind(Object(_.a)(a)),a.openEdgeContextMenu=a.openEdgeContextMenu.bind(Object(_.a)(a)),a.handleDeleteEdge=a.handleDeleteEdge.bind(Object(_.a)(a)),a.handleChangeColor=a.handleChangeColor.bind(Object(_.a)(a)),a.handleOpenEditStage=a.handleOpenEditStage.bind(Object(_.a)(a)),a.handleCloseEditStage=a.handleCloseEditStage.bind(Object(_.a)(a)),a.handleChangeStatus=a.handleChangeStatus.bind(Object(_.a)(a)),a}return Object(I.a)(n,[{key:"componentDidUpdate",value:function(e,t){var n=K(this.canvasElement.current,this.props.nodes),a=n.height,o=n.width;if(this.updateCanvasSize(a,o),!this.state.isSizeInit&&this.state.lastChangedNode){var i=K(this.canvasElement.current,this.props.nodes),s=i.height,r=i.width;this.updateCanvasSize(s,r),this.setState({isSizeInit:!0})}this.state.lastChangedNode&&(this.rerenderConnectedEdges(this.state.lastChangedNode),this.handleDecreaseCanvas(),this.setState({lastChangedNode:null})),this.state.lastDeletedNode&&this.deleteConnectedEdges(this.state.lastDeletedNode)}},{key:"handleContextMenu",value:function(e){}},{key:"closeAllContextMenu",value:function(){this.closeNodesContextMenu(),this.closeCanvasContextMenu(),this.closeEdgeContextMenu()}},{key:"handleClick",value:function(e){}},{key:"handleChangeColor",value:function(e,t){}},{key:"handleDragStart",value:function(e){e.target.classList.contains("connection-point")||e.target.classList.contains("node-title")||e.target.classList.contains("menu-point")||this.setOffsetInsideNode(e.pageX,e.pageY,e.target)}},{key:"handleDrag",value:function(e){var t=e.target;this.increaseCanvas(this.canvasElement.current,this.canvasScroll.current,t,e.pageX,e.pageY)}},{key:"handleDragEnd",value:function(e){if(!e.target.classList.contains("node-title")){var t=e.target,n=e.target.dataset.id;this.setState({isEdgeCreating:!1}),this.setState({lastChangedNode:t});this.getNewNodePosition(n,e.pageX,e.pageY)}}},{key:"handleMouseDown",value:function(e){if(e.target.classList.contains("connection-point")){var t=e.target.getAttribute("id"),n=e.target.getBoundingClientRect();this.showDemoEdge(t,n)}}},{key:"handleMouseMove",value:function(e){this.state.isEdgeCreating&&this.updateDemoEdge(e.pageX,e.pageY)}},{key:"handleMouseUp",value:function(e){if(this.state.isEdgeCreating)if(e.target.classList.contains("connection-point")){var t=e.target;this.createEdge(t),this.setState({isEdgeCreating:!1})}else this.setState({isEdgeCreating:!1})}},{key:"handleClickCreateNode",value:function(e){var t=this.getCursorPosition(e.pageX,e.pageY,e.target);t.x,this.canvasElement.current.offsetLeft,t.y,this.canvasElement.current.offsetTop}},{key:"handleDeleteNode",value:function(e){var t=e.target.closest(".node");this.setState({lastDeletedNode:t})}},{key:"handleDeleteEdge",value:function(e){}},{key:"handleUpdateTitle",value:function(e){e.target.closest(".node").dataset.id,e.target.value}},{key:"increaseCanvas",value:function(e,t,n,a,o){var i=$(e,t,n,a,o),s=i.height,r=i.width;this.updateCanvasSize(s,r)}},{key:"handleDecreaseCanvas",value:function(){var e=Z(this.canvasElement.current,this.props.nodes),t=e.height,n=e.width;this.updateCanvasSize(t,n)}},{key:"updateCanvasSize",value:function(e,t){this.canvasElement.current.style.height=e+"px",this.canvasElement.current.style.width=t+"px",this.canvasWrapper.current.style.width=t+"px"}},{key:"createEdge",value:function(e){var t=e.getAttribute("id"),n=e.getBoundingClientRect(),a=this.getConectionPointCoords(t,n);this.state.demoEdgeFrom.x,a.x}},{key:"showDemoEdge",value:function(e,t){var n=this.getConectionPointCoords(e,t);this.setState({demoEdgeFrom:n,demoEdgeTo:n,isEdgeCreating:!0})}},{key:"updateDemoEdge",value:function(e,t){var n={x:e-this.canvasElement.current.offsetLeft+this.canvasScroll.current.scrollLeft,y:t-this.canvasElement.current.offsetTop};this.setState({demoEdgeTo:n})}},{key:"rerenderConnectedEdges",value:function(e){var t=e.dataset.id,n=this.props.edges.filter((function(e){return e.from.connectionPointId.split("_")[0]===t||e.to.connectionPointId.split("_")[0]===t}));this.updateConnectedEdges(t,n)}},{key:"updateConnectedEdges",value:function(e,t){var n=this,a=t.map((function(t){var a=Object.assign({},t);return t.from.connectionPointId.split("_")[0]===e?a.from=n.getUpdatedConnectedSide(t.from):a.to=n.getUpdatedConnectedSide(t.to),[a.id,a]}));return new Map(a)}},{key:"getUpdatedConnectedSide",value:function(e){}},{key:"getConectionPointCoords",value:function(e,t){return{connectionPointId:e,x:Math.floor(t.x-this.canvasElement.current.offsetLeft)+t.width/2+window.scrollX+this.canvasScroll.current.scrollLeft,y:Math.floor(t.y-this.canvasElement.current.offsetTop)+t.height/2+window.scrollY}}},{key:"setOffsetInsideNode",value:function(e,t,n){var a=n.dataset.id,o=this.props.nodes.find((function(e){return e.id===a}));o.internalOffset={x:e-this.canvasElement.current.offsetLeft-o.position.x,y:t-this.canvasElement.current.offsetTop-o.position.y}}},{key:"getNewNodePosition",value:function(e,t,n){var a=this.props.nodes.find((function(t){return t.id===e})),o=t-this.canvasElement.current.offsetLeft-a.internalOffset.x,i=n-this.canvasElement.current.offsetTop-a.internalOffset.y;return{x:o=o<0?0:o,y:i=i<0?0:i}}},{key:"deleteConnectedEdges",value:function(e){var t=e.dataset.id,n=this.props.edges.filter((function(e){return e.from.connectionPointId.split("_")[0]===t||e.to.connectionPointId.split("_")[0]===t}));if(0!==n.length){n.map((function(e){return e.id}));this.setState({lastDeletedNode:null})}}},{key:"getCursorPosition",value:function(e,t,n){return{x:e-n.offsetLeft+this.canvasScroll.current.scrollLeft,y:t-n.offsetTop}}},{key:"setLastTouchedNode",value:function(e){this.setState({lastChangedNode:e})}},{key:"closeNodesContextMenu",value:function(){this.props.nodes.map((function(e){return e.isContextMenuOpen=!1}))}},{key:"openNodeContextMenu",value:function(e){this.props.nodes.find((function(t){return t.id===e})).isContextMenuOpen=!0}},{key:"openContextMenu",value:function(e){this.setState({isContextMenuOpen:!0,contextMenuPositionX:e.x,contextMenuPositionY:e.y})}},{key:"closeEdgeContextMenu",value:function(){this.setState({isEdgeMenuOpen:!1})}},{key:"openEdgeContextMenu",value:function(e,t,n){var a={x:t-this.canvasElement.current.offsetLeft+this.canvasScroll.current.scrollLeft,y:n-this.canvasElement.current.offsetTop};this.setState({edgeMenuPosition:a,isEdgeMenuOpen:!0,edgeId:e})}},{key:"closeCanvasContextMenu",value:function(){this.setState({isContextMenuOpen:!1})}},{key:"handleOpenEditStage",value:function(e){var t=e.target.dataset.id;this.setState({editStageId:t})}},{key:"handleCloseEditStage",value:function(){this.setState({editStageId:null})}},{key:"handleChangeStatus",value:function(e,t){this.props.onChangeStatus(e,t)}},{key:"render",value:function(){var e=this,t=window.innerWidth-30;return o.a.createElement(o.a.Fragment,null,o.a.createElement(U,{mapId:this.props.id,title:this.props.title,description:this.props.description}),o.a.createElement("div",{ref:this.canvasWrapper,style:{width:900,margin:"0 auto",maxWidth:t}},o.a.createElement("div",{ref:this.canvasScroll,className:"canvas-scroll",style:{maxWidth:t,overflow:"auto"}},o.a.createElement("div",{className:"canvas",style:{height:300},"data-allow-context-menu":"true",ref:this.canvasElement,onContextMenu:this.handleContextMenu,onClick:this.handleClick,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onMouseMove:this.handleMouseMove},o.a.createElement(q,{isOpen:this.state.isContextMenuOpen,positionX:this.state.contextMenuPositionX,positionY:this.state.contextMenuPositionY,handleClickCreateNode:this.handleClickCreateNode}),o.a.createElement(ee,{edgeId:this.state.edgeId,isOpen:this.state.isEdgeMenuOpen,positionX:this.state.edgeMenuPosition.x,positionY:this.state.edgeMenuPosition.y,onDelete:this.handleDeleteEdge}),this.props.nodes.map((function(t){return o.a.createElement(G,{key:t.id,id:t.id,title:t.data.title,color:t.data.color,status:t.data.status,position:t.position,setLastTouchedNode:e.setLastTouchedNode,openEditStage:e.handleOpenEditStage})})),this.props.edges.map((function(e){return o.a.createElement(Y,{key:e.id,id:e.id,isShown:!0,width:1.1,type:"curve",from:e.from,to:e.to})}))),this.state.editStageId?o.a.createElement(x,null,o.a.createElement(x.PassStage,{id:this.state.editStageId,onChangeStatus:this.handleChangeStatus,okButtonName:"Close",onOk:this.handleCloseEditStage})):null)))}}]),n}(o.a.Component),ne=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(){return Object(P.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleKeyUp.bind(this))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyUp)}},{key:"handleKeyUp",value:function(e){if(this.isCtrlSPressed(e)){e.preventDefault(),console.log(this.props.canvas);var t=this.props.canvas;t.nodes=this.props.nodes,t.edges=this.props.edges,this.saveCanvas("canvas/".concat(this.props.canvas.id),t).then((function(e){return console.log(e)})).catch((function(e){return console.log(e)}))}}},{key:"isCtrlSPressed",value:function(e){return!(!e.ctrlKey||"s"!==e.key)}},{key:"saveCanvas",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(e){return e.json()})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){return o.a.createElement("div",{className:"hey-stroke-handler"},this.props.children)}}]),n}(o.a.Component),ae=n(21);n(71),n(72);function oe(e){return o.a.createElement("div",{className:"comments-header"},o.a.createElement("div",{className:"comments-header-block"},o.a.createElement("h2",{className:"comments-header-title"},"\ud83d\udde8\ufe0f Comments"),o.a.createElement("h4",{className:"comments-count"},e.count," comments")))}n(73);function ie(e){var t=Object(a.useRef)(),n=Object(a.useRef)(),i=Object(a.useState)(""),s=Object(l.a)(i,2),r=s[0],c=s[1];Object(a.useEffect)((function(){v("GET","/user/you/avatar").then((function(e){return e.json()})).then((function(e){return t.current.src=e})).catch((function(e){return console.error(e)}))}),[]);return o.a.createElement("div",{className:"add-comment"},o.a.createElement("main",{className:"add-comment-body"},o.a.createElement("div",{className:"add-comment-avatar"},o.a.createElement("img",{className:"add-comment-avatar-img",ref:t})),o.a.createElement("textarea",{ref:n,className:"add-comment-field",onChange:function(e){return c(e.target.value)}})),o.a.createElement("footer",{className:"add-comment-footer"},o.a.createElement("input",{className:"add-comment-button",type:"button",onClick:function(){var t={text:r};v("POST","/maps/".concat(e.mapId,"/comment"),t).then((function(e){return e.json()})).then((function(t){return e.onCommentAdd(t)})).then((function(){return n.current.value=""})).catch((function(e){return console.error(e)}))},value:"Add comment"})))}n(74);function se(e){var t=Object(a.useRef)();Object(a.useEffect)((function(){v("GET","/user/".concat(e.commentData.user._id,"/avatar")).then((function(e){return e.json()})).then((function(e){return t.current.src=e})).catch((function(e){return console.error(e)}))}),[]);return o.a.createElement("div",{className:"comment"},o.a.createElement("div",{className:"comment-avatar"},o.a.createElement("img",{className:"comment-avatar-img",ref:t})),o.a.createElement("main",{className:"comment-main"},o.a.createElement("div",{className:"comment-main-header"},o.a.createElement("h4",{className:"comment-username"},e.commentData.user.username),o.a.createElement("div",{className:"comment-date"},e.commentData.date)),o.a.createElement("div",{className:"comment-text"},e.commentData.text),o.a.createElement("div",{className:"comment-footer"},o.a.createElement("div",{className:"comment-like",onClick:function(){alert("In progress ...")}},"\u2661 1"),o.a.createElement("div",{className:"comment-reply",onClick:function(){alert("In progress ...")}},"Reply"),e.isMy?o.a.createElement("div",{onClick:function(){return e.onDelete(e.commentData._id)},className:"comment-delete"},"Delete"):null)))}function re(e){var t=Object(a.useState)([]),n=Object(l.a)(t,2),i=n[0],s=n[1],r=Object(a.useState)([]),c=Object(l.a)(r,2),u=c[0],d=c[1],h=Object(a.useState)(0),p=Object(l.a)(h,2),m=p[0],f=p[1];Object(a.useEffect)((function(){v("GET","/maps/".concat(e.mapId,"/comments")).then((function(e){return e.json()})).then((function(e){return g(e)})).catch((function(e){return console.error(e)}))}),[]);var g=function(e){s(e.my),d(e.others),f(e.my.length+e.others.length)},E=function(t){v("DELETE","/maps/".concat(e.mapId,"/comment/").concat(t)).then((function(e){return e.json()})).then((function(e){C(t),f(m-1)})).catch((function(e){return console.error(e)}))},C=function(e){var t=i.findIndex((function(t){return t._id===e}));i.splice(t,1),s(Object(ae.a)(i))};return o.a.createElement("section",{className:"comments-section"},o.a.createElement("div",{className:"comments-container"},o.a.createElement(oe,{count:m}),o.a.createElement(ie,{onCommentAdd:function(e){s([e].concat(Object(ae.a)(i))),f(m+1)},mapId:e.mapId}),i.map((function(e,t){return o.a.createElement(se,{key:t,isMy:!0,commentData:e,onDelete:E})})),u.map((function(e,t){return o.a.createElement(se,{key:t,commentData:e})}))))}var ce=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(e){var a;Object(P.a)(this,n),(a=t.call(this,e)).state={canvasId:a.props.canvasId,nodes:[],edges:[],loading:!0};a.changeStageStatus.bind(Object(_.a)(a));return a}return Object(I.a)(n,[{key:"componentDidMount",value:function(){var e=this;v("GET","/maps/".concat(this.state.canvasId)).then((function(e){return e.json()})).then((function(t){return e.setState({canvas:t,nodes:t.stages||[],edges:t.connections||[]})})).catch((function(e){return console.log(e)})).finally((function(){return e.setState({loading:!1})}))}},{key:"render",value:function(){var e,t,n,a;return this.state.loading?o.a.createElement(L,null):o.a.createElement("div",{style:{backgroundColor:"#f9fafb"}},o.a.createElement(ne,{canvas:this.state.canvas,nodes:this.state.nodes,edges:this.state.edges},o.a.createElement(te,{id:this.state.canvasId,title:null===(e=this.state)||void 0===e||null===(t=e.canvas)||void 0===t?void 0:t.name,description:null===(n=this.state)||void 0===n||null===(a=n.canvas)||void 0===a?void 0:a.description,nodes:this.state.nodes,edges:this.state.edges,onChangeStatus:this.changeStageStatus})),o.a.createElement(re,{mapId:this.props.canvasId}))}},{key:"changeStageStatus",value:function(e,t){this.nodes.find((function(t){return t.id===e})).data.status=t}}]),n}(a.Component);function le(e){return o.a.createElement("div",{className:"canvas-header-container"},o.a.createElement("header",{className:"canvas-header"},o.a.createElement("div",{className:"header-about"},o.a.createElement("div",{className:"header-title"},e.title||"Title"),o.a.createElement("div",{className:"header-description"},e.description||"Some description")),o.a.createElement("div",{className:"header-actions"},o.a.createElement("input",{className:"header-nav-button",type:"button",value:"\u2190 Roadmaps"}),o.a.createElement("input",{className:"header-nav-button",type:"button",value:"\ud83d\uddab Save"}))))}n(75);var ue=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).state={rows:1,width:"5px",isConnectionPointsShown:!1,color:a.props.color,isHover:!1},a.handleClick=a.handleClick.bind(Object(_.a)(a)),a.setSize=a.setSize.bind(Object(_.a)(a)),a.handleMouseEnter=a.handleMouseEnter.bind(Object(_.a)(a)),a.handleMouseLeave=a.handleMouseLeave.bind(Object(_.a)(a)),a}return Object(I.a)(n,[{key:"handleClick",value:function(e){this.props.openEditStage(e)}},{key:"setSize",value:function(e){var t=e.value.split("\n"),n=t.sort((function(e,t){return t.length-e.length}))[0],a=this.getFontDescriptor(e),o=this.getTextWidth(n,a);this.setState({width:5+o+"px",rows:t.length}),this.props.setLastTouchedNode(e.closest(".node"))}},{key:"getTextWidth",value:function(e,t){var n=document.createElement("canvas").getContext("2d");return n.font=t,n.measureText(e).width}},{key:"getFontDescriptor",value:function(e){return getComputedStyle(e).getPropertyValue("font-weight")+" "+getComputedStyle(e).getPropertyValue("font-size")+" "+getComputedStyle(e).getPropertyValue("font-family")}},{key:"handleMouseEnter",value:function(e){this.setState({isHover:!0})}},{key:"handleMouseLeave",value:function(e){this.setState({isHover:!1})}},{key:"render",value:function(){var e={left:this.state.isHover?this.props.position.x-1:this.props.position.x,top:this.state.isHover?this.props.position.y-1:this.props.position.y,backgroundColor:this.props.color,width:this.state.width,zIndex:this.props.isContextMenuOpen?"4000":"1000"};return o.a.createElement("div",{"data-id":this.props.id,className:"stage-view",style:e,"data-allow-context-menu":!0,onClick:this.handleClick,onChange:this.handleChangeColor,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},o.a.createElement(W,{stageId:this.props.id,text:this.props.title,rows:this.state.rows,initSize:this.setSize,backgroundColor:this.props.color}))}}]),n}(o.a.Component),de=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).state={isContextMenuOpen:!1,isEdgeMenuOpen:!1,editStageId:null,edgeMenuPosition:{x:0,y:0},isEdgeCreating:!1,isSizeInit:!1,demoEdgeFrom:{x:0,y:0},demoEdgeTo:{x:0,y:0}},a.canvasWrapper=o.a.createRef(),a.canvasElement=o.a.createRef(),a.canvasScroll=o.a.createRef(),a.handleContextMenu=a.handleContextMenu.bind(Object(_.a)(a)),a.handleClick=a.handleClick.bind(Object(_.a)(a)),a.handleClickCreateNode=a.handleClickCreateNode.bind(Object(_.a)(a)),a.handleDeleteNode=a.handleDeleteNode.bind(Object(_.a)(a)),a.handleDragStart=a.handleDragStart.bind(Object(_.a)(a)),a.handleDrag=a.handleDrag.bind(Object(_.a)(a)),a.handleDragEnd=a.handleDragEnd.bind(Object(_.a)(a)),a.handleMouseDown=a.handleMouseDown.bind(Object(_.a)(a)),a.handleMouseUp=a.handleMouseUp.bind(Object(_.a)(a)),a.handleMouseMove=a.handleMouseMove.bind(Object(_.a)(a)),a.setLastTouchedNode=a.setLastTouchedNode.bind(Object(_.a)(a)),a.openEdgeContextMenu=a.openEdgeContextMenu.bind(Object(_.a)(a)),a.handleDeleteEdge=a.handleDeleteEdge.bind(Object(_.a)(a)),a.handleChangeColor=a.handleChangeColor.bind(Object(_.a)(a)),a.handleOpenEditStage=a.handleOpenEditStage.bind(Object(_.a)(a)),a.handleCloseEditStage=a.handleCloseEditStage.bind(Object(_.a)(a)),a}return Object(I.a)(n,[{key:"componentDidUpdate",value:function(e,t){var n=K(this.canvasElement.current,this.props.nodes),a=n.height,o=n.width;if(this.updateCanvasSize(a,o),!this.state.isSizeInit&&this.state.lastChangedNode){var i=K(this.canvasElement.current,this.props.nodes),s=i.height,r=i.width;this.updateCanvasSize(s,r),this.setState({isSizeInit:!0})}this.state.lastChangedNode&&(this.rerenderConnectedEdges(this.state.lastChangedNode),this.handleDecreaseCanvas(),this.setState({lastChangedNode:null})),this.state.lastDeletedNode&&this.deleteConnectedEdges(this.state.lastDeletedNode)}},{key:"handleContextMenu",value:function(e){}},{key:"closeAllContextMenu",value:function(){this.closeNodesContextMenu(),this.closeCanvasContextMenu(),this.closeEdgeContextMenu()}},{key:"handleClick",value:function(e){}},{key:"handleChangeColor",value:function(e,t){}},{key:"handleDragStart",value:function(e){e.target.classList.contains("connection-point")||e.target.classList.contains("node-title")||e.target.classList.contains("menu-point")||this.setOffsetInsideNode(e.pageX,e.pageY,e.target)}},{key:"handleDrag",value:function(e){var t=e.target;this.increaseCanvas(this.canvasElement.current,this.canvasScroll.current,t,e.pageX,e.pageY)}},{key:"handleDragEnd",value:function(e){if(!e.target.classList.contains("node-title")){var t=e.target,n=e.target.dataset.id;this.setState({isEdgeCreating:!1}),this.setState({lastChangedNode:t});this.getNewNodePosition(n,e.pageX,e.pageY)}}},{key:"handleMouseDown",value:function(e){if(e.target.classList.contains("connection-point")){var t=e.target.getAttribute("id"),n=e.target.getBoundingClientRect();this.showDemoEdge(t,n)}}},{key:"handleMouseMove",value:function(e){this.state.isEdgeCreating&&this.updateDemoEdge(e.pageX,e.pageY)}},{key:"handleMouseUp",value:function(e){if(this.state.isEdgeCreating)if(e.target.classList.contains("connection-point")){var t=e.target;this.createEdge(t),this.setState({isEdgeCreating:!1})}else this.setState({isEdgeCreating:!1})}},{key:"handleClickCreateNode",value:function(e){var t=this.getCursorPosition(e.pageX,e.pageY,e.target);t.x,this.canvasElement.current.offsetLeft,t.y,this.canvasElement.current.offsetTop}},{key:"handleDeleteNode",value:function(e){var t=e.target.closest(".node");this.setState({lastDeletedNode:t})}},{key:"handleDeleteEdge",value:function(e){}},{key:"handleUpdateTitle",value:function(e){e.target.closest(".node").dataset.id,e.target.value}},{key:"increaseCanvas",value:function(e,t,n,a,o){var i=$(e,t,n,a,o),s=i.height,r=i.width;this.updateCanvasSize(s,r)}},{key:"handleDecreaseCanvas",value:function(){var e=Z(this.canvasElement.current,this.props.nodes),t=e.height,n=e.width;this.updateCanvasSize(t,n)}},{key:"updateCanvasSize",value:function(e,t){this.canvasElement.current.style.height=e+"px",this.canvasElement.current.style.width=t+"px",this.canvasWrapper.current.style.width=t+"px"}},{key:"createEdge",value:function(e){var t=e.getAttribute("id"),n=e.getBoundingClientRect(),a=this.getConectionPointCoords(t,n);this.state.demoEdgeFrom.x,a.x}},{key:"showDemoEdge",value:function(e,t){var n=this.getConectionPointCoords(e,t);this.setState({demoEdgeFrom:n,demoEdgeTo:n,isEdgeCreating:!0})}},{key:"updateDemoEdge",value:function(e,t){var n={x:e-this.canvasElement.current.offsetLeft+this.canvasScroll.current.scrollLeft,y:t-this.canvasElement.current.offsetTop};this.setState({demoEdgeTo:n})}},{key:"rerenderConnectedEdges",value:function(e){var t=e.dataset.id,n=this.props.edges.filter((function(e){return e.from.connectionPointId.split("_")[0]===t||e.to.connectionPointId.split("_")[0]===t}));this.updateConnectedEdges(t,n)}},{key:"updateConnectedEdges",value:function(e,t){var n=this,a=t.map((function(t){var a=Object.assign({},t);return t.from.connectionPointId.split("_")[0]===e?a.from=n.getUpdatedConnectedSide(t.from):a.to=n.getUpdatedConnectedSide(t.to),[a.id,a]}));return new Map(a)}},{key:"getUpdatedConnectedSide",value:function(e){}},{key:"getConectionPointCoords",value:function(e,t){return{connectionPointId:e,x:Math.floor(t.x-this.canvasElement.current.offsetLeft)+t.width/2+window.scrollX+this.canvasScroll.current.scrollLeft,y:Math.floor(t.y-this.canvasElement.current.offsetTop)+t.height/2+window.scrollY}}},{key:"setOffsetInsideNode",value:function(e,t,n){var a=n.dataset.id,o=this.props.nodes.find((function(e){return e.id===a}));o.internalOffset={x:e-this.canvasElement.current.offsetLeft-o.position.x,y:t-this.canvasElement.current.offsetTop-o.position.y}}},{key:"getNewNodePosition",value:function(e,t,n){var a=this.props.nodes.find((function(t){return t.id===e})),o=t-this.canvasElement.current.offsetLeft-a.internalOffset.x,i=n-this.canvasElement.current.offsetTop-a.internalOffset.y;return{x:o=o<0?0:o,y:i=i<0?0:i}}},{key:"deleteConnectedEdges",value:function(e){var t=e.dataset.id,n=this.props.edges.filter((function(e){return e.from.connectionPointId.split("_")[0]===t||e.to.connectionPointId.split("_")[0]===t}));if(0!==n.length){n.map((function(e){return e.id}));this.setState({lastDeletedNode:null})}}},{key:"getCursorPosition",value:function(e,t,n){return{x:e-n.offsetLeft+this.canvasScroll.current.scrollLeft,y:t-n.offsetTop}}},{key:"setLastTouchedNode",value:function(e){this.setState({lastChangedNode:e})}},{key:"closeNodesContextMenu",value:function(){this.props.nodes.map((function(e){return e.isContextMenuOpen=!1}))}},{key:"openNodeContextMenu",value:function(e){this.props.nodes.find((function(t){return t.id===e})).isContextMenuOpen=!0}},{key:"openContextMenu",value:function(e){this.setState({isContextMenuOpen:!0,contextMenuPositionX:e.x,contextMenuPositionY:e.y})}},{key:"closeEdgeContextMenu",value:function(){this.setState({isEdgeMenuOpen:!1})}},{key:"openEdgeContextMenu",value:function(e,t,n){var a={x:t-this.canvasElement.current.offsetLeft+this.canvasScroll.current.scrollLeft,y:n-this.canvasElement.current.offsetTop};this.setState({edgeMenuPosition:a,isEdgeMenuOpen:!0,edgeId:e})}},{key:"closeCanvasContextMenu",value:function(){this.setState({isContextMenuOpen:!1})}},{key:"handleOpenEditStage",value:function(e){var t=e.target.dataset.id;this.setState({editStageId:t})}},{key:"handleCloseEditStage",value:function(){this.setState({editStageId:null})}},{key:"render",value:function(){var e=this,t=window.innerWidth-30;return o.a.createElement(o.a.Fragment,null,o.a.createElement(le,{title:this.props.title,description:this.props.description}),o.a.createElement("div",{ref:this.canvasWrapper,style:{width:900,margin:"0 auto",maxWidth:t}},o.a.createElement("div",{ref:this.canvasScroll,className:"canvas-scroll",style:{maxWidth:t,overflow:"auto"}},o.a.createElement("div",{className:"canvas",style:{height:300},"data-allow-context-menu":"true",ref:this.canvasElement,onContextMenu:this.handleContextMenu,onClick:this.handleClick,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onMouseMove:this.handleMouseMove},o.a.createElement(q,{isOpen:this.state.isContextMenuOpen,positionX:this.state.contextMenuPositionX,positionY:this.state.contextMenuPositionY,handleClickCreateNode:this.handleClickCreateNode}),o.a.createElement(ee,{edgeId:this.state.edgeId,isOpen:this.state.isEdgeMenuOpen,positionX:this.state.edgeMenuPosition.x,positionY:this.state.edgeMenuPosition.y,onDelete:this.handleDeleteEdge}),this.props.nodes.map((function(t){return o.a.createElement(ue,{key:t.id,id:t.id,title:t.data.title,color:t.data.color,position:t.position,setLastTouchedNode:e.setLastTouchedNode,openEditStage:e.handleOpenEditStage})})),this.props.edges.map((function(e){return o.a.createElement(Y,{key:e.id,id:e.id,isShown:!0,width:1.1,type:"curve",from:e.from,to:e.to})})),o.a.createElement(Y,{className:"demo-edge",isShown:this.state.isEdgeCreating,type:"curve",width:1,isDashed:!0,from:this.state.demoEdgeFrom,to:this.state.demoEdgeTo})),this.state.editStageId?o.a.createElement(x,null,o.a.createElement(x.EditStage,{id:this.state.editStageId,title:"Edit Stage",okButtonName:"Save",onCancel:this.handleCloseEditStage,onOk:this.handleSaveStageDescription})):null)))}}]),n}(o.a.Component),he=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).state={canvasId:a.props.canvasId,nodes:[],edges:[],loading:!0},a}return Object(I.a)(n,[{key:"componentDidMount",value:function(){var e=this;v("GET","/maps/".concat(this.state.canvasId)).then((function(e){return e.json()})).then((function(t){return e.setState({canvas:t,nodes:t.stages||[],edges:t.connections||[]})})).catch((function(e){return console.log(e)})).finally((function(){return e.setState({loading:!1})}))}},{key:"render",value:function(){var e,t,n,a;return this.state.loading?o.a.createElement(L,null):o.a.createElement("div",{style:{backgroundColor:"#f9fafb"}},o.a.createElement(ne,{canvas:this.state.canvas,nodes:this.state.nodes,edges:this.state.edges},o.a.createElement(de,{title:null===(e=this.state)||void 0===e||null===(t=e.canvas)||void 0===t?void 0:t.name,description:null===(n=this.state)||void 0===n||null===(a=n.canvas)||void 0===a?void 0:a.description,nodes:this.state.nodes,edges:this.state.edges})),o.a.createElement(re,{mapId:this.props.canvasId}))}}]),n}(a.Component),pe=n(35);function me(e){var t=Object(R.useHistory)();return o.a.createElement("div",{className:"canvas-header-container"},o.a.createElement("header",{className:"canvas-header"},o.a.createElement("div",{className:"header-about"},o.a.createElement("div",{className:"header-title"},e.title||"Title"),o.a.createElement("div",{className:"header-description"},e.description||"Some description")),o.a.createElement("div",{className:"header-actions"},o.a.createElement("input",{className:"header-nav-button",type:"button",value:"\u2190 Back",onClick:function(){t.push("/map/".concat(e.mapId,"/passing"))}}),o.a.createElement("input",{className:"header-nav-button",type:"button",value:"\ud83d\uddab Save",onClick:function(){t.push("/map/".concat(e.mapId,"/passing"))}}))))}n(76);var fe=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).inputElement=o.a.createRef(),a}return Object(I.a)(n,[{key:"componentDidMount",value:function(){this.props.initSize(this.inputElement.current)}},{key:"render",value:function(){var e={backgroundColor:this.props.backgroundColor};return o.a.createElement("textarea",{ref:this.inputElement,className:"node-title",style:e,rows:this.props.rows,defaultValue:this.props.text,draggable:!0,onDragStart:function(e){return e.preventDefault()},onChange:this.props.onChangeText,onBlur:this.props.handleUpdateTitle})}}]),n}(o.a.Component),ve=(n(77),n(78),["#EB9694","#FAD0C3","#FEF3BD","#C1E1C5","#BEDADC","#C4DEF6","#BED3F3","#D4C4FB","#B80000","#FF9800","#FCCB00","#4CAF50","#006B76","#1273DE","#004DCF","#5300EB","#FFF","lightgrey","darkgrey","grey"]),ge=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).state={color:a.props.color},a.handleColorValue=a.handleColorValue.bind(Object(_.a)(a)),a}return Object(I.a)(n,[{key:"handleColorValue",value:function(e){e.stopPropagation()}},{key:"render",value:function(){return this.props.isShown?o.a.createElement("div",{className:"color-picker"},ve.map((function(e){return o.a.createElement("div",{key:e,className:"color-picker-item",style:{backgroundColor:e},title:e,"data-color":e})})),o.a.createElement("span",null,o.a.createElement("input",{className:"color-picker-value",type:"text",defaultValue:this.props.color,onClick:this.handleColorValue}))):null}}]),n}(o.a.Component),Ee=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).state={isColorPickerShown:!1,isEditStageOpen:!1},a.handleClick=a.handleClick.bind(Object(_.a)(a)),a.handleSaveStageDescription=a.handleSaveStageDescription.bind(Object(_.a)(a)),a.closeEditStage=a.closeEditStage.bind(Object(_.a)(a)),a.openEditStage=a.openEditStage.bind(Object(_.a)(a)),a}return Object(I.a)(n,[{key:"handleClick",value:function(e){e.target.classList.contains("color-picker-item")&&this.setState({isColorPickerShown:!1}),e.target.classList.contains("menu-point-color")&&(e.stopPropagation(),this.setState({isColorPickerShown:!this.state.isColorPickerShown}))}},{key:"handleSaveStageDescription",value:function(){alert("save")}},{key:"closeEditStage",value:function(){this.setState({isEditStageOpen:!1})}},{key:"openEditStage",value:function(){this.setState({isEditStageOpen:!0})}},{key:"render",value:function(){return this.props.isOpen?o.a.createElement("div",{className:"node-context-menu"},o.a.createElement("div",{className:"menu-point","data-id":this.props.id,onClick:this.props.openEditStage},"\ud83d\udd8a\ufe0f"),o.a.createElement("div",{className:"menu-point menu-point-color",onClick:this.handleClick,draggable:!0,onDragStart:function(e){return e.preventDefault()}},"\ud83d\udd35",o.a.createElement(ge,{isShown:this.state.isColorPickerShown,color:this.props.color})),o.a.createElement("div",{className:"menu-point",onClick:this.props.handleDeleteNode},"\u2716\ufe0f")):null}}]),n}(o.a.Component),Ce=(n(79),{top:{left:"50% - 100px",top:"-2%"},right:{left:"100%",top:"50%"},bottom:{left:"50%",top:"100%"},left:{left:"0%",top:"50%"}}),be=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(){return Object(P.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"render",value:function(){var e={top:Ce[this.props.attachmentSide].top,left:Ce[this.props.attachmentSide].left};return o.a.createElement("div",{id:this.props.id,className:"connection-point",style:e,draggable:!0,onDragStart:function(e){return e.preventDefault()}})}}]),n}(o.a.Component),ye=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(){return Object(P.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"render",value:function(){var e={visibility:this.props.isShown?"visible":"hidden"};return o.a.createElement("div",{style:e},o.a.createElement(be,{id:this.props.nodeId+"_1",attachmentSide:"top"}),o.a.createElement(be,{id:this.props.nodeId+"_2",attachmentSide:"right"}),o.a.createElement(be,{id:this.props.nodeId+"_3",attachmentSide:"bottom"}),o.a.createElement(be,{id:this.props.nodeId+"_4",attachmentSide:"left"}))}}]),n}(o.a.Component),Se=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).state={rows:1,width:"5px",isConnectionPointsShown:!1,color:a.props.color},a.handleClick=a.handleClick.bind(Object(_.a)(a)),a.handleChangeTitle=a.handleChangeTitle.bind(Object(_.a)(a)),a.setSize=a.setSize.bind(Object(_.a)(a)),a.handleMouseEnter=a.handleMouseEnter.bind(Object(_.a)(a)),a.handleMouseLeave=a.handleMouseLeave.bind(Object(_.a)(a)),a.handleChangeColor=a.handleChangeColor.bind(Object(_.a)(a)),a}return Object(I.a)(n,[{key:"handleClick",value:function(e){e.target.classList.contains("color-picker-item")&&(this.setState({isConnectionPointsShown:!1}),this.props.onColorChange(this.props.id,e.target.dataset.color))}},{key:"handleChangeColor",value:function(e){e.target.classList.contains("color-picker-value")&&(console.log(e.target.value),this.setState({isConnectionPointsShown:!1}),this.props.onColorChange(this.props.id,e.target.value))}},{key:"handleChangeTitle",value:function(e){var t=e.target;this.setSize(t)}},{key:"handleMouseEnter",value:function(e){this.toggleConnectiongPoints(!0)}},{key:"handleMouseLeave",value:function(e){this.toggleConnectiongPoints(!1)}},{key:"setSize",value:function(e){var t=e.value.split("\n"),n=t.sort((function(e,t){return t.length-e.length}))[0],a=this.getFontDescriptor(e),o=this.getTextWidth(n,a);this.setState({width:5+o+"px",rows:t.length}),this.props.setLastTouchedNode(e.closest(".node"))}},{key:"getTextWidth",value:function(e,t){var n=document.createElement("canvas").getContext("2d");return n.font=t,n.measureText(e).width}},{key:"getFontDescriptor",value:function(e){return getComputedStyle(e).getPropertyValue("font-weight")+" "+getComputedStyle(e).getPropertyValue("font-size")+" "+getComputedStyle(e).getPropertyValue("font-family")}},{key:"toggleConnectiongPoints",value:function(e){this.setState({isConnectionPointsShown:e})}},{key:"render",value:function(){var e={left:this.props.position.x,top:this.props.position.y,backgroundColor:this.props.color,width:this.state.width,zIndex:this.props.isContextMenuOpen?"4000":"1000"};return o.a.createElement("div",{"data-id":this.props.id,className:"node",style:e,"data-allow-context-menu":!0,onDoubleClick:this.handleDoubleClick,draggable:!0,onDragStart:this.props.handleDragStart,onDrag:this.props.handleDrag,onDragEnd:this.props.handleDragEnd,onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onChange:this.handleChangeColor},o.a.createElement(fe,{text:this.props.title,rows:this.state.rows,initSize:this.setSize,onChangeText:this.handleChangeTitle,backgroundColor:this.props.color,handleUpdateTitle:this.props.handleUpdateTitle}),o.a.createElement(Ee,Object.assign({isOpen:this.props.isContextMenuOpen,color:this.props.color,handleDeleteNode:this.props.handleDeleteNode,openEditStage:this.props.openEditStage},this.props)),o.a.createElement(ye,{nodeId:this.props.id,isShown:this.state.isConnectionPointsShown}))}}]),n}(o.a.Component),Oe=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).state={isContextMenuOpen:!1,isEdgeMenuOpen:!1,editStageId:null,edgeMenuPosition:{x:0,y:0},isEdgeCreating:!1,isSizeInit:!1,demoEdgeFrom:{x:0,y:0},demoEdgeTo:{x:0,y:0}},a.canvasWrapper=o.a.createRef(),a.canvasElement=o.a.createRef(),a.canvasScroll=o.a.createRef(),a.handleContextMenu=a.handleContextMenu.bind(Object(_.a)(a)),a.handleClick=a.handleClick.bind(Object(_.a)(a)),a.handleClickCreateNode=a.handleClickCreateNode.bind(Object(_.a)(a)),a.handleDeleteNode=a.handleDeleteNode.bind(Object(_.a)(a)),a.handleDragStart=a.handleDragStart.bind(Object(_.a)(a)),a.handleDrag=a.handleDrag.bind(Object(_.a)(a)),a.handleDragEnd=a.handleDragEnd.bind(Object(_.a)(a)),a.handleMouseDown=a.handleMouseDown.bind(Object(_.a)(a)),a.handleMouseUp=a.handleMouseUp.bind(Object(_.a)(a)),a.handleMouseMove=a.handleMouseMove.bind(Object(_.a)(a)),a.setLastTouchedNode=a.setLastTouchedNode.bind(Object(_.a)(a)),a.openEdgeContextMenu=a.openEdgeContextMenu.bind(Object(_.a)(a)),a.handleDeleteEdge=a.handleDeleteEdge.bind(Object(_.a)(a)),a.handleChangeColor=a.handleChangeColor.bind(Object(_.a)(a)),a.handleOpenEditStage=a.handleOpenEditStage.bind(Object(_.a)(a)),a.handleCloseEditStage=a.handleCloseEditStage.bind(Object(_.a)(a)),a}return Object(I.a)(n,[{key:"componentDidUpdate",value:function(e,t){if(!this.state.isSizeInit&&this.state.lastChangedNode){var n=K(this.canvasElement.current,this.props.nodes),a=n.height,o=n.width;this.updateCanvasSize(a,o),this.setState({isSizeInit:!0})}this.state.lastChangedNode&&(this.rerenderConnectedEdges(this.state.lastChangedNode),this.handleDecreaseCanvas(),this.setState({lastChangedNode:null})),this.state.lastDeletedNode&&this.deleteConnectedEdges(this.state.lastDeletedNode)}},{key:"handleContextMenu",value:function(e){e.preventDefault(),this.closeAllContextMenu(),e.target.dataset.allowContextMenu&&(e.target.classList.contains("canvas")&&this.openContextMenu(this.getCursorPosition(e.pageX,e.pageY,e.target)),e.target.classList.contains("node")&&this.openNodeContextMenu(e.target.dataset.id),e.target.classList.contains("edge")&&this.openEdgeContextMenu(e.target.dataset.id,e.pageX,e.pageY))}},{key:"closeAllContextMenu",value:function(){this.closeNodesContextMenu(),this.closeCanvasContextMenu(),this.closeEdgeContextMenu()}},{key:"handleClick",value:function(e){this.closeAllContextMenu()}},{key:"handleChangeColor",value:function(e,t){this.props.onNodeChange(e,"data.color",t)}},{key:"handleDragStart",value:function(e){e.target.classList.contains("connection-point")||e.target.classList.contains("node-title")||e.target.classList.contains("menu-point")||this.setOffsetInsideNode(e.pageX,e.pageY,e.target)}},{key:"handleDrag",value:function(e){var t=e.target;this.increaseCanvas(this.canvasElement.current,this.canvasScroll.current,t,e.pageX,e.pageY)}},{key:"handleDragEnd",value:function(e){if(!e.target.classList.contains("node-title")){var t=e.target,n=e.target.dataset.id;this.setState({isEdgeCreating:!1}),this.setState({lastChangedNode:t});var a=this.getNewNodePosition(n,e.pageX,e.pageY);this.props.onNodeChange(n,"position",a)}}},{key:"handleMouseDown",value:function(e){if(e.target.classList.contains("connection-point")){var t=e.target.getAttribute("id"),n=e.target.getBoundingClientRect();this.showDemoEdge(t,n)}}},{key:"handleMouseMove",value:function(e){this.state.isEdgeCreating&&this.updateDemoEdge(e.pageX,e.pageY)}},{key:"handleMouseUp",value:function(e){if(this.state.isEdgeCreating)if(e.target.classList.contains("connection-point")){var t=e.target;this.createEdge(t),this.setState({isEdgeCreating:!1})}else this.setState({isEdgeCreating:!1})}},{key:"handleClickCreateNode",value:function(e){var t=this.getCursorPosition(e.pageX,e.pageY,e.target),n=t.x-this.canvasElement.current.offsetLeft,a=t.y-this.canvasElement.current.offsetTop;this.props.onNodeAdd({x:n,y:a},this.canvasScroll.current)}},{key:"handleDeleteNode",value:function(e){var t=e.target.closest(".node");this.props.onNodeDelete(t.dataset.id),this.setState({lastDeletedNode:t})}},{key:"handleDeleteEdge",value:function(e){this.props.onEdgeDelete([e])}},{key:"handleUpdateTitle",value:function(e){var t=e.target.closest(".node").dataset.id,n=e.target.value;this.props.onNodeChange(t,"data.title",n)}},{key:"increaseCanvas",value:function(e,t,n,a,o){var i=$(e,t,n,a,o),s=i.height,r=i.width;this.updateCanvasSize(s,r)}},{key:"handleDecreaseCanvas",value:function(){var e=Z(this.canvasElement.current,this.props.nodes),t=e.height,n=e.width;this.updateCanvasSize(t,n)}},{key:"updateCanvasSize",value:function(e,t){this.canvasElement.current.style.height=e+"px",this.canvasElement.current.style.width=t+"px",this.canvasWrapper.current.style.width=t+"px"}},{key:"createEdge",value:function(e){var t=e.getAttribute("id"),n=e.getBoundingClientRect(),a=this.getConectionPointCoords(t,n);this.state.demoEdgeFrom.x!==a.x&&this.props.onEdgeAdd(this.state.demoEdgeFrom,a)}},{key:"showDemoEdge",value:function(e,t){var n=this.getConectionPointCoords(e,t);this.setState({demoEdgeFrom:n,demoEdgeTo:n,isEdgeCreating:!0})}},{key:"updateDemoEdge",value:function(e,t){var n={x:e-this.canvasElement.current.offsetLeft+this.canvasScroll.current.scrollLeft,y:t-this.canvasElement.current.offsetTop};this.setState({demoEdgeTo:n})}},{key:"rerenderConnectedEdges",value:function(e){var t=e.dataset.id,n=this.props.edges.filter((function(e){return e.from.connectionPointId.split("_")[0]===t||e.to.connectionPointId.split("_")[0]===t})),a=this.updateConnectedEdges(t,n);this.props.onEdgeChange(a)}},{key:"updateConnectedEdges",value:function(e,t){var n=this,a=t.map((function(t){var a=Object.assign({},t);return t.from.connectionPointId.split("_")[0]===e?a.from=n.getUpdatedConnectedSide(t.from):a.to=n.getUpdatedConnectedSide(t.to),[a.id,a]}));return new Map(a)}},{key:"getUpdatedConnectedSide",value:function(e){var t=document.getElementById(e.connectionPointId);return this.getConectionPointCoords(e.connectionPointId,t.getBoundingClientRect())}},{key:"getConectionPointCoords",value:function(e,t){return{connectionPointId:e,x:Math.floor(t.x-this.canvasElement.current.offsetLeft)+t.width/2+window.scrollX+this.canvasScroll.current.scrollLeft,y:Math.floor(t.y-this.canvasElement.current.offsetTop)+t.height/2+window.scrollY}}},{key:"setOffsetInsideNode",value:function(e,t,n){var a=n.dataset.id,o=this.props.nodes.find((function(e){return e.id===a}));o.internalOffset={x:e-this.canvasElement.current.offsetLeft-o.position.x,y:t-this.canvasElement.current.offsetTop-o.position.y}}},{key:"getNewNodePosition",value:function(e,t,n){var a=this.props.nodes.find((function(t){return t.id===e})),o=t-this.canvasElement.current.offsetLeft-a.internalOffset.x,i=n-this.canvasElement.current.offsetTop-a.internalOffset.y;return{x:o=o<0?0:o,y:i=i<0?0:i}}},{key:"deleteConnectedEdges",value:function(e){var t=e.dataset.id,n=this.props.edges.filter((function(e){return e.from.connectionPointId.split("_")[0]===t||e.to.connectionPointId.split("_")[0]===t}));if(0!==n.length){var a=n.map((function(e){return e.id}));this.props.onEdgeDelete(a),this.setState({lastDeletedNode:null})}}},{key:"getCursorPosition",value:function(e,t,n){return{x:e-n.offsetLeft+this.canvasScroll.current.scrollLeft,y:t-n.offsetTop}}},{key:"setLastTouchedNode",value:function(e){this.setState({lastChangedNode:e})}},{key:"closeNodesContextMenu",value:function(){this.props.nodes.map((function(e){return e.isContextMenuOpen=!1}))}},{key:"openNodeContextMenu",value:function(e){this.props.nodes.find((function(t){return t.id===e})).isContextMenuOpen=!0}},{key:"openContextMenu",value:function(e){this.setState({isContextMenuOpen:!0,contextMenuPositionX:e.x,contextMenuPositionY:e.y})}},{key:"closeEdgeContextMenu",value:function(){this.setState({isEdgeMenuOpen:!1})}},{key:"openEdgeContextMenu",value:function(e,t,n){var a={x:t-this.canvasElement.current.offsetLeft+this.canvasScroll.current.scrollLeft,y:n-this.canvasElement.current.offsetTop};this.setState({edgeMenuPosition:a,isEdgeMenuOpen:!0,edgeId:e})}},{key:"closeCanvasContextMenu",value:function(){this.setState({isContextMenuOpen:!1})}},{key:"handleOpenEditStage",value:function(e){var t=e.target.dataset.id;this.setState({editStageId:t})}},{key:"handleCloseEditStage",value:function(){this.setState({editStageId:null})}},{key:"render",value:function(){var e=this,t=window.innerWidth-30;return o.a.createElement(o.a.Fragment,null,o.a.createElement(me,{mapId:this.props.id,title:this.props.title,description:this.props.description}),o.a.createElement("div",{ref:this.canvasWrapper,style:{width:900,margin:"0 auto",maxWidth:t}},o.a.createElement("div",{ref:this.canvasScroll,className:"canvas-scroll",style:{maxWidth:t,overflow:"auto"}},o.a.createElement("div",{className:"canvas",style:{height:300},"data-allow-context-menu":"true",ref:this.canvasElement,onContextMenu:this.handleContextMenu,onClick:this.handleClick,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onMouseMove:this.handleMouseMove},o.a.createElement(q,{isOpen:this.state.isContextMenuOpen,positionX:this.state.contextMenuPositionX,positionY:this.state.contextMenuPositionY,handleClickCreateNode:this.handleClickCreateNode}),o.a.createElement(ee,{edgeId:this.state.edgeId,isOpen:this.state.isEdgeMenuOpen,positionX:this.state.edgeMenuPosition.x,positionY:this.state.edgeMenuPosition.y,onDelete:this.handleDeleteEdge}),this.props.nodes.map((function(t){return o.a.createElement(Se,{key:t.id,id:t.id,title:t.data.title,color:t.data.color,position:t.position,isContextMenuOpen:t.isContextMenuOpen,handleDragStart:e.handleDragStart,handleDrag:e.handleDrag,handleDragEnd:e.handleDragEnd,handleDeleteNode:e.handleDeleteNode,handleUpdateTitle:e.handleUpdateTitle.bind(e),onColorChange:e.handleChangeColor,setLastTouchedNode:e.setLastTouchedNode,openEditStage:e.handleOpenEditStage})})),this.props.edges.map((function(e){return o.a.createElement(Y,{key:e.id,id:e.id,isShown:!0,width:1.1,type:"curve",from:e.from,to:e.to})})),o.a.createElement(Y,{className:"demo-edge",isShown:this.state.isEdgeCreating,type:"curve",width:1.1,from:this.state.demoEdgeFrom,to:this.state.demoEdgeTo})),this.state.editStageId?o.a.createElement(x,null,o.a.createElement(x.EditStage,{id:this.state.editStageId,title:"Edit Stage",okButtonName:"Save",onCancel:this.handleCloseEditStage,onOk:this.handleSaveStageDescription})):null)))}}]),n}(o.a.Component);var ke=function(e){Object(B.a)(n,e);var t=Object(z.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).state={canvasId:a.props.canvasId,nodes:[],edges:[],loading:!0},a}return Object(I.a)(n,[{key:"componentDidMount",value:function(){var e=this;v("GET","/maps/".concat(this.state.canvasId)).then((function(e){return e.json()})).then((function(t){return e.setState({canvas:t,nodes:t.stages||[],edges:t.connections||[]})})).catch((function(e){return console.log(e)})).finally((function(){return e.setState({loading:!1})}))}},{key:"render",value:function(){var e,t,n,a;return this.state.loading?o.a.createElement(L,null):o.a.createElement("div",{style:{backgroundColor:"#f9fafb"}},o.a.createElement(ne,{canvas:this.state.canvas,nodes:this.state.nodes,edges:this.state.edges},o.a.createElement(Oe,{id:this.state.canvasId,title:null===(e=this.state)||void 0===e||null===(t=e.canvas)||void 0===t?void 0:t.name,description:null===(n=this.state)||void 0===n||null===(a=n.canvas)||void 0===a?void 0:a.description,nodes:this.state.nodes,edges:this.state.edges,onNodeAdd:this.addNode.bind(this),onNodeDelete:this.deleteNode.bind(this),onNodeChange:this.updateNode.bind(this),onEdgeAdd:this.addEdge.bind(this),onEdgeDelete:this.deleteEdges.bind(this),onEdgeChange:this.updateEdges.bind(this)})),o.a.createElement("div",{style:{textAlign:"center"}},"Metadata"))}},{key:"mapToImage",value:function(e){var t=this;pe.a(e,{quality:.01}).then((function(e){return t.saveImage(e)})).catch((function(e){console.error("oops, something went wrong!",e)}))}},{key:"saveImage",value:function(e){v("PUT","/maps/".concat(this.state.canvasId,"/img"),e,"application/octet-stream").then((function(e){return e.json()})).then((function(e){return console.log(e)})).catch((function(e){return console.error(e)}))}},{key:"addNode",value:function(e,t){var n=this,a=function(e){return{id:Math.floor(1e4*Math.random()).toString(),data:{title:"new_stage",color:"lightgrey"},position:{x:e.x,y:e.y}}}(e);v("POST","/maps/".concat(this.state.canvas.id,"/stages"),[a]).then((function(e){return e.json()})).then((function(e){return n.state.nodes.concat(e)})).then((function(e){return n.setState({nodes:e})})).catch((function(e){return console.log(e)})),console.log(t),this.mapToImage(t)}},{key:"deleteNode",value:function(e){var t=this;v("DELETE","/maps/".concat(this.state.canvas.id,"/stages/").concat(e)).then((function(n){return function(e,t){var n=e.findIndex((function(e){return e.id===t})),a=e.slice(0,n);return a.push.apply(a,Object(ae.a)(e.slice(n+1,e.length))),a}(t.state.nodes,e)})).then((function(e){return t.setState({nodes:e})})).catch((function(e){return console.log(e)}))}},{key:"updateNode",value:function(e,t,n){var a=this.state.nodes.find((function(t){return t.id===e}));!function e(t,n,a){if(1!==n.length)return e(t[n[0]],n.slice(1),a);t[n]=a}(a,t.split("."),n),v("PUT","/stages/".concat(e),a).then((function(e){return e.json()})).catch((function(e){return console.log(e)}))}},{key:"addEdge",value:function(e,t){var n=this,a=function(e,t){return{id:Math.floor(1e4*Math.random()+1e3).toString(),from:e,to:t}}(e,t);v("POST","/maps/".concat(this.state.canvas.id,"/connections"),[a]).then((function(e){return e.json()})).then((function(e){return n.state.edges.concat(e)})).then((function(e){return n.setState({edges:e})})).catch((function(e){return console.log(e)}))}},{key:"deleteEdges",value:function(e){var t=this;v("DELETE","/maps/".concat(this.state.canvas.id,"/connections?ids=")+e.join(",")).then((function(n){return function(e,t){return e.filter((function(e){return-1===t.indexOf(e.id)}))}(t.state.edges,e)})).then((function(e){return t.setState({edges:e})})).catch((function(e){return console.log(e)}))}},{key:"updateEdges",value:function(e){!function(e,t){e.forEach((function(e){var n=t.get(e.id);n&&(e.from=n.from,e.to=n.to)}))}(this.state.edges,e);var t=Array.from(e.values());v("PUT","/maps/".concat(this.state.canvas.id,"/connections"),t).catch((function(e){return console.log(e)}))}}]),n}(a.Component);function Ne(e){return je.apply(this,arguments)}function je(){return(je=Object(h.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.ok){e.next=4;break}return e.next=3,t.json();case 3:return e.abrupt("return",e.sent);case 4:return e.next=6,t.json();case 6:return n=e.sent,e.next=9,Promise.reject(n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(){var e=Object(a.useState)(""),t=Object(l.a)(e,2),n=t[0],i=t[1],s=Object(a.useState)(""),r=Object(l.a)(s,2),c=r[0],u=r[1],p=Object(a.useState)(""),f=Object(l.a)(p,2),v=f[0],g=f[1],E=function(){var e=Object(h.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a={email:n,password:c},e.next=4,fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((function(e){return Ne(e)})).then((function(e){return m("mpx_user",e,1)})).then((function(){return window.location.href="/"})).catch((function(e){return g(e.message)}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return o.a.createElement("div",{className:"auth-block"},o.a.createElement("div",{className:"login-left-content"},o.a.createElement("h2",null,"Log in"),o.a.createElement("div",{className:"auth-welcome-msg"},"Welcome to Mapex, , please log in to start using this app"),o.a.createElement("form",{className:"auth-form"},o.a.createElement("div",{className:"login-forms-fieldset"},o.a.createElement("div",{className:"auth-form-field"},o.a.createElement("label",null,"E-mail"),o.a.createElement("input",{type:"email",onChange:function(e){return i(e.target.value)}})),o.a.createElement("div",{className:"auth-form-field"},o.a.createElement("label",null,"Password"),o.a.createElement("input",{type:"password",onChange:function(e){return u(e.target.value)}}))),o.a.createElement("div",{className:"forgot-password"},"Forgot password?"),o.a.createElement("button",{className:"auth-btn",onClick:E},"Log in"),o.a.createElement("div",{className:"error-msg"},v)),o.a.createElement("div",{className:"signup-link"},"Don't have an account? ",o.a.createElement("span",{className:"signup-btn",onClick:function(){window.location.href="/registration"}},"Sign up"))))}n(25);var Me=n(34),we=n.n(Me);function De(e){return o.a.createElement("div",{className:"auth-content"},o.a.createElement("div",null,o.a.createElement("div",null,o.a.createElement("div",{className:"promo-img-block"},o.a.createElement("img",{className:"promo-img",src:we.a}))),o.a.createElement("div",{className:"auth-content-footer"},o.a.createElement("h3",{className:"description-title"},"Build a plan"),o.a.createElement("div",{className:"description-text"},"Build your path or take someone else's experience to achieve your goals"),o.a.createElement("div",{className:"description-scroll"},o.a.createElement("div",{className:"prev"}),o.a.createElement("div",{className:"scroll-index"},"\u29bf \u25cb \u25cb"),o.a.createElement("div",{className:"next"})))))}function Le(e){return o.a.createElement("div",{className:"auth"},o.a.createElement(xe,null),o.a.createElement(De,null))}function Te(e){return e.isAuthenticated?e.children:o.a.createElement(c.Redirect,{to:"/login"})}function Pe(e){return Ie.apply(this,arguments)}function Ie(){return(Ie=Object(h.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.ok){e.next=4;break}return e.next=3,t.json();case 3:return e.abrupt("return",e.sent);case 4:return e.next=6,t.json();case 6:return n=e.sent,e.next=9,Promise.reject(n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _e(){var e=Object(a.useState)(""),t=Object(l.a)(e,2),n=t[0],i=t[1],s=Object(a.useRef)(null),r=Object(a.useState)(""),c=Object(l.a)(r,2),u=c[0],p=c[1],f=Object(a.useRef)(null),v=Object(a.useState)(""),g=Object(l.a)(v,2),E=g[0],C=g[1],b=Object(a.useState)(""),y=Object(l.a)(b,2),S=y[0],O=y[1],k=function(){var e=Object(h.a)(d.a.mark((function e(t){var a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!(a=N())){e.next=5;break}return O(a),e.abrupt("return");case 5:return o={email:n,password:u},console.log(o),e.next=9,fetch("/auth/registration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then((function(e){return Pe(e)})).then((function(e){return m("mpx_user",e,1)})).then((function(){return window.location.href="/"})).catch((function(e){O(e.message),console.error(e.error)}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){return s.current.validity.valid?f.current.validity.valid?u!==E?"Passwords do not match":null:"Password must be at least 8 characters long and contain uppercase and lowercase letters and numbers":"Incorrect email"};return o.a.createElement("div",{className:"auth-block"},o.a.createElement("div",{className:"login-left-content"},o.a.createElement("h2",null,"Create account"),o.a.createElement("div",{className:"auth-welcome-msg"},"Access guides by creating an account"),o.a.createElement("form",{className:"auth-form"},o.a.createElement("div",{className:"login-forms-fieldset"},o.a.createElement("div",{className:"auth-form-field "},o.a.createElement("label",null,"E-mail"),o.a.createElement("input",{type:"email",required:!0,ref:s,onChange:function(e){return i(e.target.value)},onFocus:function(){return O("")}})),o.a.createElement("div",{className:"auth-form-field"},o.a.createElement("label",null,"Password"),o.a.createElement("input",{type:"password",required:!0,ref:f,pattern:"^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d]{8,}$",onFocus:function(){return O("")},onChange:function(e){return p(e.target.value)}})),o.a.createElement("div",{className:"auth-form-field"},o.a.createElement("label",null,"Repeat password"),o.a.createElement("input",{type:"password",required:!0,onFocus:function(){return O("")},onChange:function(e){return C(e.target.value)}}))),o.a.createElement("button",{className:"auth-btn",onClick:k},"Create account"),o.a.createElement("div",{className:"error-msg"},S)),o.a.createElement("div",{className:"signup-link"},"Already have an account? ",o.a.createElement("span",{className:"signup-btn",onClick:function(){window.location.href="/login"}},"Sign in"))))}function Be(){return o.a.createElement("div",{className:"auth"},o.a.createElement(_e,null),o.a.createElement(De,null))}n(80);function ze(e){var t=e.id,n=e.title,i=e.description,s=Object(c.useHistory)(),r=Object(a.useState)(!1),u=Object(l.a)(r,2),d=u[0],h=u[1],p=Object(a.useState)(!1),m=Object(l.a)(p,2),f=m[0],g=m[1],E=Object(a.useState)(n),C=Object(l.a)(E,2),b=C[0],y=C[1],S=Object(a.useState)(i),O=Object(l.a)(S,2),k=O[0],N=O[1],j=Object(a.useRef)(null);return Object(a.useEffect)((function(){v("GET","/maps/".concat(e.id,"/img")).then((function(e){return e.json()})).then((function(e){j.current.src=e})).catch((function(e){return console.error(e)}))}),[]),o.a.createElement("div",{className:"map-pin",style:{display:f?"none":"block"},onClick:function(){s.push("/map/".concat(t,"/view"))}},o.a.createElement("div",{className:"map-pin__preview",onMouseLeave:function(){return h(!1)}},o.a.createElement("img",{className:"map-pin__image",ref:j}),o.a.createElement("div",{className:"map-pin__description"},k),o.a.createElement("div",{className:"map-pin__menu-btn",onClick:function(e){h(!d),e.stopPropagation()}},"...",o.a.createElement(w,{isOpen:d,canvasId:t,canvasTitle:b,canvasDescription:k,hideBoardPin:function(){return g(!0)},updateBoardPin:function(e,t){y(e),N(t)}})),o.a.createElement("div",{className:"map-pin__overlay"})),o.a.createElement("div",{className:"board-pin__info"},o.a.createElement("div",{className:"board-pin__info-title",title:b},b)))}n(81);function Re(){var e=Object(a.useState)(!0),t=Object(l.a)(e,2),n=t[0],i=t[1],s=Object(a.useState)([]),r=Object(l.a)(s,2),c=r[0],u=r[1];return Object(a.useEffect)((function(){var e=!0;return v("GET","/maps/all").then((function(e){return e.json()})).then((function(t){e&&u(t)})).catch((function(e){return console.log(e)})).finally((function(){return i(!1)})),function(){e=!1}}),[]),n?o.a.createElement(L,null):o.a.createElement("div",{className:"suggestions-container"},o.a.createElement("div",{className:"suggestions"},c.map((function(e){return o.a.createElement(ze,{key:e.id,id:e.id,title:e.name,description:e.description})}))))}function Ue(e){var t=Object(R.useParams)().mapId;return o.a.createElement(o.a.Fragment,null,o.a.Children.map(e.children,(function(e){return o.a.cloneElement(e,{canvasId:t})})))}var Fe=function(){return o.a.createElement("div",{className:"App"},o.a.createElement(r.a,null,o.a.createElement(c.Switch,null,o.a.createElement(c.Route,{path:"/login"},o.a.createElement(Le,null)),o.a.createElement(c.Route,{path:"/registration"},o.a.createElement(Be,null)),o.a.createElement(c.Route,{path:"/library"},o.a.createElement(Te,{isAuthenticated:f("mpx_user")},o.a.createElement(k,null),o.a.createElement(T,null))),o.a.createElement(c.Route,{path:"/map/:mapId/view"},o.a.createElement(Te,{isAuthenticated:f("mpx_user")},o.a.createElement(k,null),o.a.createElement(Ue,null,o.a.createElement(he,null)))),o.a.createElement(c.Route,{path:"/map/:mapId/passing"},o.a.createElement(Te,{isAuthenticated:f("mpx_user")},o.a.createElement(k,null),o.a.createElement(Ue,null,o.a.createElement(ce,null)))),o.a.createElement(c.Route,{path:"/map/:mapId/edit"},o.a.createElement(Te,{isAuthenticated:f("mpx_user")},o.a.createElement(k,null),o.a.createElement(Ue,null,o.a.createElement(ke,null)))),o.a.createElement(c.Route,{path:"/user/:userId"},o.a.createElement(Te,{isAuthenticated:f("mpx_user")},o.a.createElement(k,null),o.a.createElement(j,null),o.a.createElement(T,null))),o.a.createElement(c.Route,{path:"/"},o.a.createElement(Te,{isAuthenticated:f("mpx_user")},o.a.createElement(k,null),o.a.createElement(Re,null))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(Fe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}]),[[36,1,2]]]);
//# sourceMappingURL=main.dd171ca3.chunk.js.map